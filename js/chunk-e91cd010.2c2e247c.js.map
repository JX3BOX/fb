{"version":3,"sources":["webpack:///./src/views/Drop_v2.vue","webpack:///./src/service/drop.js","webpack:///src/views/Drop_v2.vue","webpack:///./src/views/Drop_v2.vue?d2b4","webpack:///./src/views/Drop_v2.vue?0674","webpack:///./src/views/Drop_v2.vue?092f"],"names":["render","_vm","this","_c","_self","directives","name","rawName","value","loading","expression","staticClass","attrs","model","mapid","callback","$$v","_l","maplist","item","i","key","mode","map_id","bosslist","j","class","on","BOSS","boss","$event","changeBoss","_v","_s","schoolmap","school_name","school_id","active","school","filterBySchool","_f","droptype","dropmap","groupname","group","droplist","length","drop","isVisible","id","getDropLink","viewDrop","slot","ItemQuality","iconLink","ItemIconID","ItemName","focus","ItemID","jx3_item_id","client_id","_e","staticRenderFns","$","$node","getBoss","client","arguments","undefined","get","params","MapID","getDropV2","concat","getResource","type","data","post","props","computed","fb","$route","query","fb_name","$store","state","default_fb","dungeons","getters","_this$dungeons","_this$dungeons$this$f","BossName","methods","loadData","_this","loadBossList","then","loadDropList","_this2","res","_loadDropList","_asyncToGenerator","_regeneratorRuntime","mark","_callee","old","_drops","_items","drops","item_ids","items","_iterator","_step","_drop$ApplicableSchoo","_iterator2","_step2","cacheKey","_iterator3","_step3","_drop","_this3","wrap","_context","prev","next","sent","map","getDropItemID","ids","_createForOfIteratorHelper","s","n","done","schools","ApplicableSchoolIDs","split","err","e","f","sessionStorage","setItem","JSON","stringify","jx3_item","t0","$message","error","console","log","finish","stop","_x","apply","oldBoss","dropitem","ItemExtID","ItemType","getLink","_drop$schools","schoolIsVisible","includes","categoryIsVisible","Source","AucGenre","watch","immediate","handler","_this$maplist","val","filters","showSchoolIcon","__imgPath","components","Item","component"],"mappings":"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","file":"js/chunk-e91cd010.2c2e247c.js","sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],staticClass:\"m-fb-drop\"},[_c('el-tabs',{attrs:{\"type\":\"card\"},model:{value:(_vm.mapid),callback:function ($$v) {_vm.mapid=$$v},expression:\"mapid\"}},_vm._l((_vm.maplist),function(item,i){return _c('el-tab-pane',{key:i,attrs:{\"label\":item.mode,\"name\":item.map_id}},[_c('div',{staticClass:\"u-bosslist\"},_vm._l((_vm.bosslist),function(item,j){return _c('div',{key:j,staticClass:\"u-boss\",class:{ on: item.BOSS == _vm.boss },on:{\"click\":function($event){return _vm.changeBoss(item.BOSS)}}},[_c('svg',{class:'u-boss-avatar',attrs:{\"xmlns\":\"http://www.w3.org/2000/svg\",\"width\":\"833.7\",\"height\":\"833.7\",\"viewBox\":\"0 0 833.7 833.7\",\"svg-inline\":'',\"role\":'presentation',\"focusable\":'false',\"tabindex\":'-1'}},[_c('path',{attrs:{\"d\":\"M416.8 0C208.5.1 39.6 169 39.6 377.399V555.2c0 9.399 4.4 18.199 11.9 23.899L213.7 702.2v101.5c0 16.6 13.4 30 30 30h24.1c16.6 0 30-13.4 30-30v-41.2c0-10.5 8.5-19 19-19s19 8.5 19 19v41.2c0 16.6 13.4 30 30 30h1c16.6 0 30-13.4 30-30v-41.2c0-10.5 8.5-19 19-19h2c10.5 0 19 8.5 19 19v41.2c0 16.6 13.4 30 30 30h1c16.6 0 30-13.4 30-30v-41.2c0-10.5 8.5-19 19-19s19 8.5 19 19v41.2c0 16.6 13.4 30 30 30H590c16.6 0 30-13.4 30-30V702.1L782.2 579c7.5-5.7 11.899-14.5 11.899-23.9V377.3C794 169 625.1.1 416.8 0zM259.1 558.1c-57.4 0-104-46.6-104-104 0-57.399 46.6-104 104-104s104 46.601 104 104c0 57.5-46.6 104-104 104zm187.3 76.5h-59.1c-13.7 0-22.4-14.7-15.8-26.7l29.6-53.699c6.8-12.4 24.7-12.4 31.5 0l29.601 53.699c6.5 11.999-2.201 26.7-15.801 26.7zm128.1-76.5c-57.4 0-104-46.6-104-104 0-57.399 46.6-104 104-104 57.399 0 104 46.601 104 104 0 57.5-46.5 104-104 104z\"}})]),_vm._v(\" \"+_vm._s(item.BOSS)+\" \")])}),0),_c('div',{staticClass:\"u-schools\"},_vm._l((_vm.schoolmap),function(school_name,school_id){return _c('div',{key:school_id,staticClass:\"u-school\",class:{ active: school_id == _vm.school },on:{\"click\":function($event){return _vm.filterBySchool(school_id)}}},[_c('img',{staticClass:\"u-school-icon\",attrs:{\"src\":_vm._f(\"showSchoolIcon\")(school_id),\"alt\":school_name}}),_c('span',{staticClass:\"u-school-name\"},[_vm._v(_vm._s(~~school_id ? school_name : \"全部\"))])])}),0),_c('div',{staticClass:\"u-droplist\"},[_c('div',{staticClass:\"u-tabs\"},[_c('el-tabs',{staticClass:\"u-group\",attrs:{\"tab-position\":\"left\"},model:{value:(_vm.droptype),callback:function ($$v) {_vm.droptype=$$v},expression:\"droptype\"}},[_c('el-tab-pane',{attrs:{\"label\":\"全部\",\"name\":\"\"}}),_vm._l((_vm.dropmap),function(groupname,group){return _c('el-tab-pane',{key:group,attrs:{\"label\":groupname,\"name\":group}})})],2)],1),(_vm.droplist && _vm.droplist.length)?_c('div',{staticClass:\"u-drops\"},_vm._l((_vm.droplist),function(drop){return _c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isVisible(drop)),expression:\"isVisible(drop)\"}],key:drop.id,staticClass:\"u-item-wrapper\"},[_c('el-popover',{attrs:{\"placement\":\"right-end\",\"popper-class\":\"u-drop-popup\",\"width\":\"auto\",\"visible-arrow\":false,\"trigger\":\"hover\",\"transition\":\"none\",\"close-delay\":0}},[_c('a',{staticClass:\"u-item\",attrs:{\"slot\":\"reference\",\"href\":_vm.getDropLink(drop),\"target\":\"_blank\"},on:{\"mouseenter\":function($event){return _vm.viewDrop(drop)}},slot:\"reference\"},[_c('i',{staticClass:\"u-drop-item-icon u-item-icon\",class:'u-item-color-' + drop.ItemQuality},[_c('img',{attrs:{\"src\":_vm.iconLink(drop.ItemIconID)}})]),_c('span',{staticClass:\"u-item-name\"},[_vm._v(_vm._s(drop.ItemName))])]),(_vm.focus == drop.ItemID)?_c('jx3-item',{attrs:{\"item_id\":drop.jx3_item_id,\"jx3-client-type\":_vm.client_id}}):_vm._e()],1)],1)}),0):_c('el-alert',{attrs:{\"title\":\"没有相关条目\",\"type\":\"info\",\"show-icon\":\"\"}})],1)])}),1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { $node } from \"@jx3box/jx3box-common/js/https\";\nconst $ = $node();\n\n// import axios from \"axios\";\n// const $ = axios.create({\n//     baseURL: \"http://localhost:7002/\",\n// });\n\nfunction getBoss(map_id, client = \"std\") {\n    return $.get(\"/fb/boss\", {\n        params: {\n            MapID: map_id,\n            client: client,\n        },\n    });\n}\n\nfunction getDrop(bossindex, client = \"std\") {\n    return $.get(\"/fb/drop/\" + bossindex, {\n        params: {\n            client: client,\n        },\n    })\n}\n\nfunction getDropV2(mapid, params) {\n    return $.get(`/fb/drop/v2/${mapid}`, {\n        params: params\n    })\n}\n\nfunction getResource(type, client, data) {\n    return $.post(`/resource/${client}/${type}`, data)\n}\n\nexport { getDrop, getBoss, getDropV2, getResource };\n","<template>\n    <div class=\"m-fb-drop\" v-loading=\"loading\">\n        <el-tabs v-model=\"mapid\" type=\"card\">\n            <el-tab-pane :label=\"item.mode\" :name=\"item.map_id\" v-for=\"(item, i) in maplist\" :key=\"i\">\n                <div class=\"u-bosslist\">\n                    <div\n                        class=\"u-boss\"\n                        :class=\"{ on: item.BOSS == boss }\"\n                        v-for=\"(item, j) in bosslist\"\n                        :key=\"j\"\n                        @click=\"changeBoss(item.BOSS)\"\n                    >\n                        <!-- <img :src=\"bossavatar(j)\" /> -->\n                        <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"833.7\" height=\"833.7\" viewBox=\"0 0 833.7 833.7\" v-bind:class=\"'u-boss-avatar'\" v-bind:svg-inline=\"''\" v-bind:role=\"'presentation'\" v-bind:focusable=\"'false'\" v-bind:tabindex=\"'-1'\"><path d=\"M416.8 0C208.5.1 39.6 169 39.6 377.399V555.2c0 9.399 4.4 18.199 11.9 23.899L213.7 702.2v101.5c0 16.6 13.4 30 30 30h24.1c16.6 0 30-13.4 30-30v-41.2c0-10.5 8.5-19 19-19s19 8.5 19 19v41.2c0 16.6 13.4 30 30 30h1c16.6 0 30-13.4 30-30v-41.2c0-10.5 8.5-19 19-19h2c10.5 0 19 8.5 19 19v41.2c0 16.6 13.4 30 30 30h1c16.6 0 30-13.4 30-30v-41.2c0-10.5 8.5-19 19-19s19 8.5 19 19v41.2c0 16.6 13.4 30 30 30H590c16.6 0 30-13.4 30-30V702.1L782.2 579c7.5-5.7 11.899-14.5 11.899-23.9V377.3C794 169 625.1.1 416.8 0zM259.1 558.1c-57.4 0-104-46.6-104-104 0-57.399 46.6-104 104-104s104 46.601 104 104c0 57.5-46.6 104-104 104zm187.3 76.5h-59.1c-13.7 0-22.4-14.7-15.8-26.7l29.6-53.699c6.8-12.4 24.7-12.4 31.5 0l29.601 53.699c6.5 11.999-2.201 26.7-15.801 26.7zm128.1-76.5c-57.4 0-104-46.6-104-104 0-57.399 46.6-104 104-104 57.399 0 104 46.601 104 104 0 57.5-46.5 104-104 104z\"/></svg>\n                        {{ item.BOSS }}\n                    </div>\n                </div>\n                <div class=\"u-schools\">\n                    <div\n                        class=\"u-school\"\n                        v-for=\"(school_name, school_id) in schoolmap\"\n                        :key=\"school_id\"\n                        @click=\"filterBySchool(school_id)\"\n                        :class=\"{ active: school_id == school }\"\n                    >\n                        <img class=\"u-school-icon\" :src=\"school_id | showSchoolIcon\" :alt=\"school_name\" />\n                        <span class=\"u-school-name\">{{ ~~school_id ? school_name : \"全部\" }}</span>\n                    </div>\n                </div>\n                <div class=\"u-droplist\">\n                    <div class=\"u-tabs\">\n                        <el-tabs tab-position=\"left\" class=\"u-group\" v-model=\"droptype\">\n                            <el-tab-pane label=\"全部\" name></el-tab-pane>\n                            <el-tab-pane\n                                :label=\"groupname\"\n                                v-for=\"(groupname, group) in dropmap\"\n                                :key=\"group\"\n                                :name=\"group\"\n                            ></el-tab-pane>\n                        </el-tabs>\n                    </div>\n                    <div class=\"u-drops\" v-if=\"droplist && droplist.length\">\n                        <div class=\"u-item-wrapper\" v-for=\"drop in droplist\" :key=\"drop.id\" v-show=\"isVisible(drop)\">\n                            <el-popover\n                                placement=\"right-end\"\n                                popper-class=\"u-drop-popup\"\n                                width=\"auto\"\n                                :visible-arrow=\"false\"\n                                trigger=\"hover\"\n                                transition=\"none\"\n                                :close-delay=\"0\"\n                            >\n                                <a\n                                    slot=\"reference\"\n                                    class=\"u-item\"\n                                    :href=\"getDropLink(drop)\"\n                                    target=\"_blank\"\n                                    @mouseenter=\"viewDrop(drop)\"\n                                >\n                                    <i class=\"u-drop-item-icon u-item-icon\" :class=\"'u-item-color-' + drop.ItemQuality\">\n                                        <img :src=\"iconLink(drop.ItemIconID)\" />\n                                    </i>\n                                    <span class=\"u-item-name\">{{ drop.ItemName }}</span>\n                                </a>\n                                <jx3-item\n                                    :item_id=\"drop.jx3_item_id\"\n                                    :jx3-client-type=\"client_id\"\n                                    v-if=\"focus == drop.ItemID\"\n                                />\n                            </el-popover>\n                        </div>\n                    </div>\n                    <el-alert v-else title=\"没有相关条目\" type=\"info\" show-icon></el-alert>\n                </div>\n            </el-tab-pane>\n        </el-tabs>\n        <!-- <router-link class=\"u-switch-version\" to=\"/drop\"><i class=\"el-icon-sort\"></i> 切换至旧版</router-link> -->\n    </div>\n</template>\n\n<script>\nimport { getDropV2, getBoss } from \"../service/drop\";\nimport { __iconPath, __ossRoot, __imgPath } from \"@jx3box/jx3box-common/data/jx3box.json\";\nimport dropmap from \"../assets/data/drop_types.json\";\nimport { getLink, iconLink, jx3ClientType } from \"@jx3box/jx3box-common/js/utils\";\nimport schoolmap from \"@jx3box/jx3box-data/data/xf/schoolid.json\";\nimport Item from \"@jx3box/jx3box-editor/src/Item.vue\";\nimport { getResource } from \"@/service/drop\";\n// import drop_item from \"../components/drop_item\";\n\nexport default {\n    name: \"DropV2\",\n    props: [],\n    data: function () {\n        return {\n            mapid: \"\",\n            bosslist: [],\n            boss: \"\",\n\n            dropmap,\n            droplist: [],\n            droptype: \"\",\n\n            focus: \"\",\n            data: {},\n            loading: false,\n\n            school: \"0\",\n            schoolmap,\n        };\n    },\n    computed: {\n        fb: function () {\n            return this.$route.query.fb_name || this.$store.state.default_fb;\n        },\n        dungeons() {\n            return this.$store.getters.dungeons;\n        },\n        client: function () {\n            return this.$store.state.client || \"std\";\n        },\n        maplist: function () {\n            return this.dungeons?.[this.fb]?.[\"maps\"];\n        },\n        params: function () {\n            return {\n                client: this.client,\n                BossName: this.boss,\n                // ItemType: this.droptype,\n            };\n        },\n        client_id: function () {\n            return this.client == \"std\" ? 1 : 2;\n        },\n    },\n    methods: {\n        loadData: function () {\n            this.loadBossList().then(() => {\n                this.loadDropList();\n            });\n        },\n        loadBossList: function () {\n            return getBoss(this.mapid, this.client).then((res) => {\n                this.bosslist = res?.data || [];\n                this.boss = this.bosslist[0][\"BOSS\"];\n            });\n        },\n        loadDropList: async function (old) {\n            try {\n                this.loading = true;\n                let drops = await getDropV2(this.mapid, this.params);\n                drops = drops?.data;\n            \n                let item_ids = drops.map((drop) => this.getDropItemID(drop));\n                let items = await getResource(\"item_merged\", this.client, {\n                    ids: item_ids,\n                });\n                // 用到的物品找出来，先缓存防止多次请求\n                items = items?.data;\n                for (let drop of drops) {\n                    drop.schools = drop?.ApplicableSchoolIDs?.split(\"|\");\n                    drop.jx3_item_id = this.getDropItemID(drop);\n                }\n\n                for (let item of items) {\n                    let cacheKey = `item-${this.client}-${item.id}`;\n                    sessionStorage.setItem(cacheKey, JSON.stringify(item));\n                    for (let drop of drops) {\n                        if (drop.jx3_item_id == item.id) {\n                            drop.jx3_item = item;\n                        }\n                    }\n                }\n\n                this.droplist = drops;\n            } catch (e) {\n                this.$message.error(\"数据获取失败，请稍后再试\");\n                this.boss = old;\n                console.log(e);\n            } finally {\n                this.loading = false;\n            }\n        },\n        changeBoss: function (boss) {\n            let oldBoss = this.boss;\n            this.boss = boss;\n            this.loadDropList(oldBoss);\n        },\n        getDropItemID: function (dropitem) {\n            return dropitem.ItemExtID\n                ? `${dropitem.ItemType}_${dropitem.ItemID}_${dropitem.ItemExtID}`\n                : `${dropitem.ItemType}_${dropitem.ItemID}`;\n        },\n        getDropLink(dropitem) {\n            return getLink(\"item\", dropitem.jx3_item_id);\n        },\n        filterBySchool(school_id) {\n            this.school = school_id;\n        },\n        isVisible: function (drop) {\n            let schoolIsVisible = !~~this.school || drop.schools?.includes(this.school);\n            // let categoryIsVisible = !~~this.droptype || drop.ItemType == this.droptype; 要根据具体物品判断\n            let categoryIsVisible = false;\n            // 以防万一 找不到对应物品直接不显示\n            if (!drop.jx3_item) return false;\n            if (this.droptype == 5) {\n                if (drop.jx3_item.Source == \"other\") categoryIsVisible = true;\n                if (drop.jx3_item.Source == \"trinket\" && [5, 20, 22].includes(~~drop.jx3_item.AucGenre))\n                    categoryIsVisible = true; // 5=坐骑 20=宠物 22=挂件\n            } else if ([6, 7, 8].includes(~~this.droptype)) {\n                if (drop.jx3_item.Source == \"trinket\" && [5, 20, 22].includes(~~drop.jx3_item.AucGenre)) {\n                    categoryIsVisible = false;\n                } else {\n                    categoryIsVisible = ~~drop.ItemType == this.droptype;\n                }\n            } else if (!~~this.droptype) {\n                categoryIsVisible = true;\n            }\n            return categoryIsVisible && schoolIsVisible;\n        },\n        viewDrop: function (item) {\n            this.focus = item.ItemID;\n        },\n        iconLink: function (id) {\n            return iconLink(id, this.client);\n        },\n    },\n    watch: {\n        fb: {\n            immediate: true,\n            handler: function () {\n                this.mapid = this.maplist?.[0][\"map_id\"];\n                this.loadData();\n            },\n        },\n        mapid: {\n            handler: function (val) {\n                val && this.loadData();\n            },\n        },\n        \"$route.query.mapid\": {\n            immediate: true,\n            handler: function (val) {\n                if (val) this.mapid = val;\n            },\n        },\n        \"$route.query.boss\": {\n            immediate: true,\n            handler: function (val) {\n                if (val) this.boss = val;\n            },\n        },\n    },\n    filters: {\n        showSchoolIcon: function (val) {\n            return __imgPath + \"image/school/\" + val + \".png\";\n        },\n    },\n    components: {\n        // drop_item,\n        \"jx3-item\": Item,\n    },\n};\n</script>\n\n<style lang=\"less\">\n@import \"../assets/css/drop.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./Drop_v2.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./Drop_v2.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./Drop_v2.vue?vue&type=template&id=a7d135e0\"\nimport script from \"./Drop_v2.vue?vue&type=script&lang=js\"\nexport * from \"./Drop_v2.vue?vue&type=script&lang=js\"\nimport style0 from \"./Drop_v2.vue?vue&type=style&index=0&id=a7d135e0&prod&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./Drop_v2.vue?vue&type=style&index=0&id=a7d135e0&prod&lang=less\""],"sourceRoot":""}